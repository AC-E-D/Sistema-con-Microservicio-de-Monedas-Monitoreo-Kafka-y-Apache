<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Monitoreo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-4">

    <div class="d-flex justify-content-between mb-3">
        <h2>Dashboard de Monitoreo</h2>

        <a href="{% url 'productos' %}" class="btn btn-secondary">Volver a Productos</a>
    </div>

    <div class="row">

        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">CPU</div>
                <div class="card-body">
                    <h3 id="cpu_val">--%</h3>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">RAM</div>
                <div class="card-body">
                    <h3 id="ram_val">--%</h3>
                </div>
            </div>
        </div>

    </div>

    <div class="row">

        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">Kafka (últimos eventos)</div>
                <div class="card-body">
                    <pre id="kafka_logs">Cargando...</pre>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">Últimos errores</div>
                <div class="card-body">
                    <pre id="error_logs">Cargando...</pre>
                </div>
            </div>
        </div>

    </div>

</div>

<script>
function actualizarDashboard() {
    fetch("{% url 'monitor_data' %}")
        .then(r => r.json())
        .then(data => {
            document.getElementById("cpu_val").textContent = data.cpu + "%";
            document.getElementById("ram_val").textContent = data.ram + "%";

            document.getElementById("kafka_logs").textContent =
                data.kafka.length ? data.kafka.join("\n") : "Sin eventos";

            document.getElementById("error_logs").textContent =
                data.errors.length ? data.errors.join("\n") : "Sin errores";
        })
        .catch(err => console.log("error:", err));
}

// refrescar cada 2 segundos
setInterval(actualizarDashboard, 2000);
actualizarDashboard();
</script>

</body>
</html>
